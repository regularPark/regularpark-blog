---
title: '[ìš°ì•„í•œí…Œí¬ì½”ìŠ¤] ë ˆë²¨3 í”„ë¡ íŠ¸ì—”ë“œ ë°°í¬ ê³¼ì • #3'
date: 2023-08-26
thumbnail: /assets/level3/jenkins.png
categories: FE,ìš°ì•„í•œí…Œí¬ì½”ìŠ¤,ë ˆë²¨3,ë°°í¬
---

ëŒ€ë§ì˜ ë°°í¬ ìë™í™”ì— ëŒ€í•´ í¬ìŠ¤íŒ…í•  ì‹œê°„ì´ë„¤ìš”.

ì´ì „ì˜ í¬ìŠ¤íŒ…ë“¤ì´ ì‚¬ì‹¤ìƒ ì–´ë– í•œ ìì„¸í•œ ì„¤ëª…ì—†ì´ ì‹¤í–‰ë°©ë²•ë§Œì„ ê¸°ë¡í•˜ê±°ë‚˜, ê°„ë‹¨íˆ ê²½í—˜ë§Œì„ ê°€ë³ê²Œ í’€ì–´ë‚¸ ê²ƒì´ì—ˆë‹¤ë©´, ì´ë²ˆ í¬ìŠ¤íŒ…ì—ì„œëŠ” í˜„ì¬ì˜ ë°°í¬ í˜•íƒœë¥¼ ìì„¸íˆ ëœ¯ì–´ë³´ë ¤ê³  í•´ìš”.

í”„ë¡œì íŠ¸ 6ì£¼ì°¨ê¹Œì§€ëŠ” ë°°í¬ë¥¼ í•´ì£¼ê¸° ìœ„í•´ì„œëŠ” ê²°êµ­ ì‰˜ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•´ì£¼ì–´ì•¼í•˜ëŠ” **ìˆ˜ë™ ë°°í¬** í˜•íƒœë¥¼ ë„ê³  ìˆì—ˆì£ ? í•˜ì§€ë§Œ ê°œë°œìë¡œì„œ ìˆ˜ë™ì´ë¼ëŠ” ë‹¨ì–´ë¥¼ ìš©ë‚©í•  ìˆ˜ ì—†ì§€ ì•Šê² ì–´ìš”? ê²°ì½” CI/CDê°€ í”„ë¡œì íŠ¸ ìš”êµ¬ì‚¬í•­ì´ê¸° ë•Œë¬¸ì€ ì•„ë‹ˆë¼ëŠ” ì  ì•Œì•„ì£¼ì„¸ìš”ğŸ˜…

ê·¸ë˜ì„œ ì €ì™€ ë¼ì‡ì´ ê¸°ëŠ¥ êµ¬í˜„ê³¼ UI/UXì— ì§‘ì¤‘í•˜ëŠ” ë™ì•ˆ ìœ¤ìƒì´ CDë¥¼ ìœ„í•´ ì•„ì£¼ ì• ë¥¼ ì¨ì£¼ì—ˆê³ , ê·¸ ê³¼ì •ì„ ì˜†ì—ì„œ ì§€ì¼œë³¸ ì œê°€ ë¬¸ì„œí™”ë¥¼ í•´ë³´ê¸°ë¡œ í–ˆìŠµë‹ˆë‹¤.

### 4\. ìë™í™”

2ì°¨ ë°ëª¨ë°ì´ ì´í›„ ë°±ì—”ë“œ í¬ë£¨ë“¤ì´ ë„ì»¤ì— ì  í‚¨ìŠ¤ë¥¼ ì„¤ì¹˜, ë°°í¬ ìë™í™”ë„ êµ¬í˜„í•´ë†“ì€ ìƒíƒœì˜€ìŠµë‹ˆë‹¤. ì´ì— ë³¸ê²©ì ìœ¼ë¡œ í”„ë¡ íŠ¸ì—”ë“œ ì¸í”„ë¼ êµ¬ì¶•ì— ë‚˜ì„  ìœ¤ìƒì´ ì  í‚¨ìŠ¤ íŒŒì´í”„ë¼ì¸ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‘ì„±í•˜ì—¬ Gitì—ì„œ í”„ë¡œì íŠ¸ê°€ mergeë  ë•Œë§ˆë‹¤ ìë™ìœ¼ë¡œ ë°°í¬ê°€ ë˜ë„ë¡ í•˜ì˜€ìŠµë‹ˆë‹¤.

ì œê°€ ë‹¤ë£° ë‚´ìš©ì€ ì  í‚¨ìŠ¤ê°€ ì„¤ì¹˜ëœ ì´í›„ì— ë°°í¬ ìë™í™” ì„¤ì •ì— ëŒ€í•œ ê²ƒì…ë‹ˆë‹¤.

ì  í‚¨ìŠ¤ê°€ ì„¤ì¹˜ë˜ì–´ìˆê³ , ì  í‚¨ìŠ¤ ê³„ì •ì´ ìˆê³ , ì´ˆê¸° ì„¸íŒ…ì´ ë˜ì–´ìˆìœ¼ë©°, íŠ¸ë¦¬ê±°ê°€ `merge`ë˜ì—ˆì„ ë•Œì„ì„ ê°€ì •í•˜ê³  ì§„í–‰í•©ë‹ˆë‹¤.

í”„ë¡œì íŠ¸ì˜ êµ¬ì„±ì„ í´ë¦­í•˜ì—¬ ì§„í–‰í•´ë³¼ê²Œìš”.

#### 1\. ê¹ƒí—ˆë¸Œ í”„ë¡œì íŠ¸ ì„¤ì •

![í”„ë¡œì íŠ¸ ì„¤ì •](/assets/level3/gitrepo.png)

ë°°í¬í•  ë•Œ ì‚¬ìš©í•  ì†ŒìŠ¤ì½”ë“œê°€ ì¡´ì¬í•˜ëŠ” ë ˆí¬ì§€í„°ë¦¬ë¥¼ ì„¤ì •í•´ì¤ë‹ˆë‹¤.

#### 2\. íŒŒì´í”„ë¼ì¸ ìŠ¤í¬ë¦½íŠ¸ ì‘ì„±

í”„ë¡œì íŠ¸ì˜ develop ë¸Œëœì¹˜ì—ì„œ mergeí•˜ëŠ” í–‰ìœ„ê°€ íŒŒì´í”„ë¼ì¸ì˜ íŠ¸ë¦¬ê±°ê°€ ë˜ëŠ”ë°ìš”.

ê·¸ëŸ¼ ì´ì œ ì´ íŒŒì´í”„ë¼ì¸ì´ ì–´ë–»ê²Œ ë™ì‘í•  ì§€ë¥¼ ìŠ¤í¬ë¦½íŠ¸ë¡œ ì‘ì„±í•˜ëŠ” ì ˆì°¨ë¥¼ ì§„í–‰í•©ë‹ˆë‹¤.

êµ¬ì„± -> pipelineìœ¼ë¡œ ì´ë™í•˜ì—¬ì„œ

> ê¹ƒ ë ˆí¬ì§€í„°ë¦¬ì—ì„œ develop ë¸Œëœì¹˜ì˜ ì†ŒìŠ¤ì½”ë“œë¥¼ ê°€ì ¸ì™€ ë¹Œë“œí•˜ê³ , ê·¸ íŒŒì¼ì„ ì••ì¶•í•œ ë’¤, EC2ì— ë³´ëƒ…ë‹ˆë‹¤. ê·¸ë¦¬ê³  deploy ë‹¨ê³„ì—ì„œ ec2ì— ì‘ì„±í•´ ë†“ì€ run.shë¥¼ ì‹¤í–‰í•˜ì—¬ NGINX ë‚´ì—ì„œ ë¹Œë“œë¥¼ ì™„ë£Œí•©ë‹ˆë‹¤.

ìœ„ì™€ ê°™ì€ ì ˆì°¨ë¥¼ ì§„í–‰í•˜ëŠ” pipeline ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì•„ë˜ì™€ ê°™ì´ ì‘ì„±í•˜ì˜€ìŠµë‹ˆë‹¤.

```
pipeline {
    agent any
                // í™˜ê²½ë³€ìˆ˜ ì„¤ì •
        environment {
        NODEJS_HOME = tool name: 'NodeJS', type: 'jenkins.plugins.nodejs.tools.NodeJSInstallation'
        PATH = "${NODEJS_HOME}/bin:${env.PATH}"
    }
    stages {
                // git branchì—ì„œ ê°€ì ¸ì˜´
        stage('Github') {
            steps {
                git branch: 'develop', url: 'https://github.com/woowacourse-teams/2023-stamp-crush.git'
            }
        }
                // ë¹Œë“œ
        stage('Build') {
            steps {
              dir('frontend'){
              sh 'node -v'
              sh "echo 'REACT_APP_BASE_URL' = 'https://www.stampcrush.site/api' > .env"
              sh 'npm i && npm run build'
              }
             }
        }
              // ë¹Œë“œëœ íŒŒì¼ ì••ì¶•
        stage('compress file') {
            steps {
              dir('frontend') {
                  sh 'tar -cvf dist.tar dist'
              }
            }
        }
                // ì••ì¶•ëœ íŒŒì¼ sshë¡œ ì „ì†¡
        stage('send file to instance') {
            steps {
                dir('frontend') {
                    sshagent(credentials: ['key-stamp-crush']){
                        sh 'scp -o StrictHostKeyChecking=no dist.tar ubuntu@XXX.XXX.XXX.XXX:/home/ubuntu/frontend'
                    }
                }
            }
        }
                // ec2 ì¸ìŠ¤í„´ìŠ¤ì— ìˆëŠ” ì‰˜ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
        stage('deploy') {
            steps {
                dir('frontend') {
                    sshagent(credentials: ['key-stamp-crush']){
                        sh 'ssh ubuntu@XXX.XXX.XXX.XXX ./frontend/run.sh'
                    }
                }
            }
        }
    }

}
```

./frontend/run.sh

```
#!/bin/bash

# ì••ì¶•ëœ dist ë””ë ‰í† ë¦¬ì˜ ì••ì¶•ì„ í•´ì œí•©ë‹ˆë‹¤.
tar -xvf /home/ubuntu/frontend/dist.tar -C /home/ubuntu/frontend

# ì••ì¶•í•´ì œëœ dist ë””ë ‰í† ë¦¬ë¥¼ nginxë¡œ ì´ë™ì‹œí‚µë‹ˆë‹¤.
sudo cp -r /home/ubuntu/frontend/dist /usr/share/nginx
# nginxë¥¼ ë‹¤ì‹œ ì‹œì‘í•©ë‹ˆë‹¤.
sudo systemctl restart nginx.service
# í•„ìš”ì—†ëŠ” íŒŒì¼ì„ ì§€ì›ë‹ˆë‹¤.
rm -rf ./frontend/dist && rm -rf ./frontend/dist.tar
```

ìœ„ ì½”ë“œëŠ” deploy ìŠ¤í…Œì´ì§€ì— ì‹¤í–‰ë  run.shì¸ë°ìš”.

ì••ì¶•í•˜ì—¬ ì „ì†¡í•œ ë¹Œë“œ íŒŒì¼ì˜ ì••ì¶•ì„ í‘¼ ë’¤, í•´ì²´ëœ ë¹Œë“œ íŒŒì¼ì„ NGINXë¡œ ì´ë™ì‹œí‚µë‹ˆë‹¤. ì´í›„ ì´ì „ í¬ìŠ¤íŒ…ì—ì„œ ë³´ì•˜ë˜ restart ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ì—¬ NGINXë¥¼ ì¬ì‹œì‘í•˜ì—¬ ë°°í¬ ìë™í™”ë¥¼ ì´ë£©í•´ë‚´ëŠ”ë°ìš”.

ì´ ì¼ë ¨ì˜ ê³¼ì •ë“¤(deployì˜ run.shë™ì‘ì„ ì œì™¸í•œ)ì„ ì  í‚¨ìŠ¤ì˜ Stage Viewì—ì„œ ë¼ì´ë¸Œë¡œ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤!

ì˜ˆë¥¼ ë“¤ì–´ develop ë¸Œëœì¹˜ì— mergeë¥¼ í•˜ê²Œ ë˜ë©´!

![ì  í‚¨ìŠ¤ CD](/assets/level3/jenkins.png)

ì§œë€~ ì´ì œ ìœ„ì™€ ê°™ì´ ì  í‚¨ìŠ¤ì—ì„œ ì§„í–‰ ìƒí™©ì„ ì²´í¬í•  ìˆ˜ ìˆêµ¬ìš”. ê° ì—´ì˜ íƒ€ì´í‹€ì„ ë³´ì‹œë©´ íŒŒì´í”„ë¼ì¸ ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ì‘ì„±í•œ stageì˜ ì´ë¦„ë“¤ì„ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ìƒ ì €í¬ ìŠ¤íƒ¬í”„ í¬ëŸ¬ì‰¬ íŒ€ì˜ CD ê³¼ì •ì„ ê¸°ë¡í•œ í¬ìŠ¤íŒ…ì´ì—ˆìŠµë‹ˆë‹¤.

ì½ì–´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤.

---

í‹°ìŠ¤í† ë¦¬ ë¸”ë¡œê·¸ì— ì‘ì„±í•œ í¬ìŠ¤íŒ…ì„ ì˜®ê¸´ ê²ƒì…ë‹ˆë‹¤.
